let MvvLvaValue=[0,100,200,300,400,500,600,100,200,300,400,500,600],MvvLvaScores=new Array(196);function InitMvvLva(){let e,E;for(e=PIECES.wP;e<=PIECES.bK;++e)for(E=PIECES.wP;E<=PIECES.bK;++E)MvvLvaScores[14*E+e]=MvvLvaValue[E]+6-MvvLvaValue[e]/100}function MoveExists(e){let E;GenerateMoves();let a=NOMOVE;for(E=GameBoard.moveListStart[GameBoard.ply];E<GameBoard.moveListStart[GameBoard.ply+1];++E)if(a=GameBoard.moveList[E],MakeMove(a)!=BOOL.FALSE&&(TakeMove(),e==a))return BOOL.TRUE;return BOOL.FALSE}function MOVE(e,E,a,o,d){return e|E<<7|a<<14|o<<20|d}function AddCaptureMove(e){GameBoard.moveList[GameBoard.moveListStart[GameBoard.ply+1]]=e,GameBoard.moveScores[GameBoard.moveListStart[GameBoard.ply+1]++]=MvvLvaScores[14*CAPTURED(e)+GameBoard.pieces[FROMSQ(e)]]+1e6}function AddQuietMove(e){GameBoard.moveList[GameBoard.moveListStart[GameBoard.ply+1]]=e,GameBoard.moveScores[GameBoard.moveListStart[GameBoard.ply+1]]=0,e==GameBoard.searchKillers[GameBoard.ply]?GameBoard.moveScores[GameBoard.moveListStart[GameBoard.ply+1]]=9e5:e==GameBoard.searchKillers[GameBoard.ply+MAXDEPTH]?GameBoard.moveScores[GameBoard.moveListStart[GameBoard.ply+1]]=8e5:GameBoard.moveScores[GameBoard.moveListStart[GameBoard.ply+1]]=GameBoard.searchHistory[GameBoard.pieces[FROMSQ(e)]*BRD_SQ_NUM+TOSQ(e)],GameBoard.moveListStart[GameBoard.ply+1]++}function AddEnPassantMove(e){GameBoard.moveList[GameBoard.moveListStart[GameBoard.ply+1]]=e,GameBoard.moveScores[GameBoard.moveListStart[GameBoard.ply+1]++]=1000105}function AddWhitePawnCaptureMove(e,E,a){RanksBrd[e]==RANKS.RANK_7?(AddCaptureMove(MOVE(e,E,a,PIECES.wQ,0)),AddCaptureMove(MOVE(e,E,a,PIECES.wR,0)),AddCaptureMove(MOVE(e,E,a,PIECES.wB,0)),AddCaptureMove(MOVE(e,E,a,PIECES.wN,0))):AddCaptureMove(MOVE(e,E,a,PIECES.EMPTY,0))}function AddBlackPawnCaptureMove(e,E,a){RanksBrd[e]==RANKS.RANK_2?(AddCaptureMove(MOVE(e,E,a,PIECES.bQ,0)),AddCaptureMove(MOVE(e,E,a,PIECES.bR,0)),AddCaptureMove(MOVE(e,E,a,PIECES.bB,0)),AddCaptureMove(MOVE(e,E,a,PIECES.bN,0))):AddCaptureMove(MOVE(e,E,a,PIECES.EMPTY,0))}function AddWhitePawnQuietMove(e,E){RanksBrd[e]==RANKS.RANK_7?(AddQuietMove(MOVE(e,E,PIECES.EMPTY,PIECES.wQ,0)),AddQuietMove(MOVE(e,E,PIECES.EMPTY,PIECES.wR,0)),AddQuietMove(MOVE(e,E,PIECES.EMPTY,PIECES.wB,0)),AddQuietMove(MOVE(e,E,PIECES.EMPTY,PIECES.wN,0))):AddQuietMove(MOVE(e,E,PIECES.EMPTY,PIECES.EMPTY,0))}function AddBlackPawnQuietMove(e,E){RanksBrd[e]==RANKS.RANK_2?(AddQuietMove(MOVE(e,E,PIECES.EMPTY,PIECES.bQ,0)),AddQuietMove(MOVE(e,E,PIECES.EMPTY,PIECES.bR,0)),AddQuietMove(MOVE(e,E,PIECES.EMPTY,PIECES.bB,0)),AddQuietMove(MOVE(e,E,PIECES.EMPTY,PIECES.bN,0))):AddQuietMove(MOVE(e,E,PIECES.EMPTY,PIECES.EMPTY,0))}function GenerateMoves(){let e,E,a,o,d,S,P;if(GameBoard.moveListStart[GameBoard.ply+1]=GameBoard.moveListStart[GameBoard.ply],GameBoard.side==COLOURS.WHITE){for(e=PIECES.wP,E=0;E<GameBoard.pceNum[e];++E)a=GameBoard.pList[PCEINDEX(e,E)],GameBoard.pieces[a+10]==PIECES.EMPTY&&(AddWhitePawnQuietMove(a,a+10),RanksBrd[a]==RANKS.RANK_2&&GameBoard.pieces[a+20]==PIECES.EMPTY&&AddQuietMove(MOVE(a,a+20,PIECES.EMPTY,PIECES.EMPTY,MFLAGPS))),SQOFFBOARD(a+9)==BOOL.FALSE&&PieceCol[GameBoard.pieces[a+9]]==COLOURS.BLACK&&AddWhitePawnCaptureMove(a,a+9,GameBoard.pieces[a+9]),SQOFFBOARD(a+11)==BOOL.FALSE&&PieceCol[GameBoard.pieces[a+11]]==COLOURS.BLACK&&AddWhitePawnCaptureMove(a,a+11,GameBoard.pieces[a+11]),GameBoard.enPas!=SQUARES.NO_SQ&&(a+9==GameBoard.enPas&&AddEnPassantMove(MOVE(a,a+9,PIECES.EMPTY,PIECES.EMPTY,MFLAGEP)),a+11==GameBoard.enPas&&AddEnPassantMove(MOVE(a,a+11,PIECES.EMPTY,PIECES.EMPTY,MFLAGEP)));GameBoard.castlePerm&CASTLEBIT.WKCA&&GameBoard.pieces[SQUARES.F1]==PIECES.EMPTY&&GameBoard.pieces[SQUARES.G1]==PIECES.EMPTY&&SqAttacked(SQUARES.F1,COLOURS.BLACK)==BOOL.FALSE&&SqAttacked(SQUARES.E1,COLOURS.BLACK)==BOOL.FALSE&&AddQuietMove(MOVE(SQUARES.E1,SQUARES.G1,PIECES.EMPTY,PIECES.EMPTY,MFLAGCA)),GameBoard.castlePerm&CASTLEBIT.WQCA&&GameBoard.pieces[SQUARES.D1]==PIECES.EMPTY&&GameBoard.pieces[SQUARES.C1]==PIECES.EMPTY&&GameBoard.pieces[SQUARES.B1]==PIECES.EMPTY&&SqAttacked(SQUARES.D1,COLOURS.BLACK)==BOOL.FALSE&&SqAttacked(SQUARES.E1,COLOURS.BLACK)==BOOL.FALSE&&AddQuietMove(MOVE(SQUARES.E1,SQUARES.C1,PIECES.EMPTY,PIECES.EMPTY,MFLAGCA))}else{for(e=PIECES.bP,E=0;E<GameBoard.pceNum[e];++E)a=GameBoard.pList[PCEINDEX(e,E)],GameBoard.pieces[a-10]==PIECES.EMPTY&&(AddBlackPawnQuietMove(a,a-10),RanksBrd[a]==RANKS.RANK_7&&GameBoard.pieces[a-20]==PIECES.EMPTY&&AddQuietMove(MOVE(a,a-20,PIECES.EMPTY,PIECES.EMPTY,MFLAGPS))),SQOFFBOARD(a-9)==BOOL.FALSE&&PieceCol[GameBoard.pieces[a-9]]==COLOURS.WHITE&&AddBlackPawnCaptureMove(a,a-9,GameBoard.pieces[a-9]),SQOFFBOARD(a-11)==BOOL.FALSE&&PieceCol[GameBoard.pieces[a-11]]==COLOURS.WHITE&&AddBlackPawnCaptureMove(a,a-11,GameBoard.pieces[a-11]),GameBoard.enPas!=SQUARES.NO_SQ&&(a-9==GameBoard.enPas&&AddEnPassantMove(MOVE(a,a-9,PIECES.EMPTY,PIECES.EMPTY,MFLAGEP)),a-11==GameBoard.enPas&&AddEnPassantMove(MOVE(a,a-11,PIECES.EMPTY,PIECES.EMPTY,MFLAGEP)));GameBoard.castlePerm&CASTLEBIT.BKCA&&GameBoard.pieces[SQUARES.F8]==PIECES.EMPTY&&GameBoard.pieces[SQUARES.G8]==PIECES.EMPTY&&SqAttacked(SQUARES.F8,COLOURS.WHITE)==BOOL.FALSE&&SqAttacked(SQUARES.E8,COLOURS.WHITE)==BOOL.FALSE&&AddQuietMove(MOVE(SQUARES.E8,SQUARES.G8,PIECES.EMPTY,PIECES.EMPTY,MFLAGCA)),GameBoard.castlePerm&CASTLEBIT.BQCA&&GameBoard.pieces[SQUARES.D8]==PIECES.EMPTY&&GameBoard.pieces[SQUARES.C8]==PIECES.EMPTY&&GameBoard.pieces[SQUARES.B8]==PIECES.EMPTY&&SqAttacked(SQUARES.D8,COLOURS.WHITE)==BOOL.FALSE&&SqAttacked(SQUARES.E8,COLOURS.WHITE)==BOOL.FALSE&&AddQuietMove(MOVE(SQUARES.E8,SQUARES.C8,PIECES.EMPTY,PIECES.EMPTY,MFLAGCA))}for(o=LoopNonSlideIndex[GameBoard.side],d=LoopNonSlidePce[o++];0!=d;){for(E=0;E<GameBoard.pceNum[d];++E)for(a=GameBoard.pList[PCEINDEX(d,E)],index=0;index<DirNum[d];index++)S=a+(P=PceDir[d][index]),SQOFFBOARD(S)!=BOOL.TRUE&&(GameBoard.pieces[S]!=PIECES.EMPTY?PieceCol[GameBoard.pieces[S]]!=GameBoard.side&&AddCaptureMove(MOVE(a,S,GameBoard.pieces[S],PIECES.EMPTY,0)):AddQuietMove(MOVE(a,S,PIECES.EMPTY,PIECES.EMPTY,0)));d=LoopNonSlidePce[o++]}for(o=LoopSlideIndex[GameBoard.side],d=LoopSlidePce[o++];0!=d;){for(E=0;E<GameBoard.pceNum[d];++E)for(a=GameBoard.pList[PCEINDEX(d,E)],index=0;index<DirNum[d];index++)for(S=a+(P=PceDir[d][index]);SQOFFBOARD(S)==BOOL.FALSE;){if(GameBoard.pieces[S]!=PIECES.EMPTY){PieceCol[GameBoard.pieces[S]]!=GameBoard.side&&AddCaptureMove(MOVE(a,S,GameBoard.pieces[S],PIECES.EMPTY,0));break}AddQuietMove(MOVE(a,S,PIECES.EMPTY,PIECES.EMPTY,0)),S+=P}d=LoopSlidePce[o++]}}function GenerateCaptures(){let e,E,a,o,d,S,P;if(GameBoard.moveListStart[GameBoard.ply+1]=GameBoard.moveListStart[GameBoard.ply],GameBoard.side==COLOURS.WHITE)for(e=PIECES.wP,E=0;E<GameBoard.pceNum[e];++E)a=GameBoard.pList[PCEINDEX(e,E)],SQOFFBOARD(a+9)==BOOL.FALSE&&PieceCol[GameBoard.pieces[a+9]]==COLOURS.BLACK&&AddWhitePawnCaptureMove(a,a+9,GameBoard.pieces[a+9]),SQOFFBOARD(a+11)==BOOL.FALSE&&PieceCol[GameBoard.pieces[a+11]]==COLOURS.BLACK&&AddWhitePawnCaptureMove(a,a+11,GameBoard.pieces[a+11]),GameBoard.enPas!=SQUARES.NO_SQ&&(a+9==GameBoard.enPas&&AddEnPassantMove(MOVE(a,a+9,PIECES.EMPTY,PIECES.EMPTY,MFLAGEP)),a+11==GameBoard.enPas&&AddEnPassantMove(MOVE(a,a+11,PIECES.EMPTY,PIECES.EMPTY,MFLAGEP)));else for(e=PIECES.bP,E=0;E<GameBoard.pceNum[e];++E)a=GameBoard.pList[PCEINDEX(e,E)],SQOFFBOARD(a-9)==BOOL.FALSE&&PieceCol[GameBoard.pieces[a-9]]==COLOURS.WHITE&&AddBlackPawnCaptureMove(a,a-9,GameBoard.pieces[a-9]),SQOFFBOARD(a-11)==BOOL.FALSE&&PieceCol[GameBoard.pieces[a-11]]==COLOURS.WHITE&&AddBlackPawnCaptureMove(a,a-11,GameBoard.pieces[a-11]),GameBoard.enPas!=SQUARES.NO_SQ&&(a-9==GameBoard.enPas&&AddEnPassantMove(MOVE(a,a-9,PIECES.EMPTY,PIECES.EMPTY,MFLAGEP)),a-11==GameBoard.enPas&&AddEnPassantMove(MOVE(a,a-11,PIECES.EMPTY,PIECES.EMPTY,MFLAGEP)));for(o=LoopNonSlideIndex[GameBoard.side],d=LoopNonSlidePce[o++];0!=d;){for(E=0;E<GameBoard.pceNum[d];++E)for(a=GameBoard.pList[PCEINDEX(d,E)],index=0;index<DirNum[d];index++)S=a+(P=PceDir[d][index]),SQOFFBOARD(S)!=BOOL.TRUE&&GameBoard.pieces[S]!=PIECES.EMPTY&&PieceCol[GameBoard.pieces[S]]!=GameBoard.side&&AddCaptureMove(MOVE(a,S,GameBoard.pieces[S],PIECES.EMPTY,0));d=LoopNonSlidePce[o++]}for(o=LoopSlideIndex[GameBoard.side],d=LoopSlidePce[o++];0!=d;){for(E=0;E<GameBoard.pceNum[d];++E)for(a=GameBoard.pList[PCEINDEX(d,E)],index=0;index<DirNum[d];index++)for(S=a+(P=PceDir[d][index]);SQOFFBOARD(S)==BOOL.FALSE;){if(GameBoard.pieces[S]!=PIECES.EMPTY){PieceCol[GameBoard.pieces[S]]!=GameBoard.side&&AddCaptureMove(MOVE(a,S,GameBoard.pieces[S],PIECES.EMPTY,0));break}S+=P}d=LoopSlidePce[o++]}}